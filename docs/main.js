!function(){var t=window.localStorage,i="wins",e={};t&&(e=JSON.parse(t.getItem(i))||{});var n=document.getElementById("canvas"),o=n.getContext("2d");o.font="30px Arial";var r,s=1,a=parseInt(n.getAttribute("width"),10),l=parseInt(n.getAttribute("height"),10),c=20,u=0,h={winner:null,gameOverStart:null,statScreenStart:null},f=(r=0,function(){return++r});function p(t,i){return Math.random()*(i-t)+t}function m(t){return{alive:!0,color:t,direction:{x:p(.1,.5),y:p(.1,.5)},id:f(),position:{x:p(c,a-c),y:p(c,l-c)},size:{width:c,height:c},team:t,hitPoints:10,heals:3,strength:Math.ceil(p(1,3))}}function d(){for(var t=[],i=0;i<3;i++)t=t.concat([m("red"),m("blue"),m("green"),m("yellow"),m("orange"),m("teal"),m("brown")]);return{frame:{collisions:[]},objects:t,input:{}}}var w=d();function y(){o.fillStyle="black",o.fillRect(0,0,a,l)}function x(t){if(y(),o.font="30px Arial",u=t,e&&t-h.statScreenStart<3e3){o.fillStyle="white";var i=50;for(var n in o.fillText("Wins:",10,i),e)i+=30,o.fillStyle=n,o.fillText(n+" : "+e[n],10,i);requestAnimationFrame(x)}else requestAnimationFrame(g)}function g(t){y(),u=t,w=new d,requestAnimationFrame(z)}function v(t,i){t.hitPoints-=i,t.hitPoints<=0&&(t.alive=!1)}function S(t,i){t.hitPoints<10&&(t.hitPoints+=i.heals,i.heals--,t.hitPoints>10&&(t.hitPoints=10),i.heals<0&&(i.heals=0))}function A(t){y(),u=t,o.font="30px Arial",o.fillStyle="white",o.fillText("Game Over, winner: "+h.winner,10,50),t-h.gameOverStart>2e3?(h.statScreenStart=t,requestAnimationFrame(x)):requestAnimationFrame(A)}function z(n){y(),w.frame.collisions=[],w.objects.forEach((function(t){!function(t){t.alive&&(o.fillStyle="white",o.font="10px Arial",o.fillText(t.hitPoints+"/"+t.strength,t.position.x,t.position.y-10)),o.fillStyle=t.color,o.fillRect(t.position.x,t.position.y,t.size.width,t.size.height)}(t)})),s=w.input.ArrowUp?2:w.input.ArrowDown?.5:1;var r=(n-u)*s;w.objects.forEach((function(t){!function(t,i){null!=t.direction&&t.alive&&(t.position.x+=i*t.direction.x,t.position.y+=i*t.direction.y,(t.position.x+t.size.width>a||t.position.x<0)&&(t.direction.x*=-1),(t.position.y+t.size.height>l||t.position.y<0)&&(t.direction.y*=-1),t.position.y<0&&(t.position.y=0),t.position.y>l-t.size.height&&(t.position.y=l-t.size.height),t.position.x<0&&(t.position.x=0),t.position.x>a-t.size.width&&(t.position.x=a-t.size.width),w.objects.forEach((function(i){i.id!==t.id&&(i.alive&&function(t,i){return t.position.x<i.position.x+i.size.width&&t.position.x+t.size.width>i.position.x&&t.position.y<i.position.y+i.size.height&&t.size.height+t.position.y>i.position.y}(t,i)?t.team!==i.team?(Math.random()<.5?v(t,i.strength):v(i,t.strength),t.color="white",i.color="white",w.frame.collisions.push([t,i])):(S(t,i),S(i,t)):(t.color=t.team,i.color=i.team))})))}(t,r)})),u=n;var c,f=w.objects.filter((function(t){return t.alive})).reduce((function(t,i){return-1===t.indexOf(i.team)&&t.push(i.team),t}),[]);1!==f.length?requestAnimationFrame(z):(c=f[0],h.winner=c,e[h.winner]?e[h.winner]++:e[h.winner]=1,t&&t.setItem(i,JSON.stringify(e)),h.gameOverStart=n,requestAnimationFrame(A))}requestAnimationFrame((function(t){y(),u=t,document.onkeydown=function(t){t.preventDefault(),w.input[t.code]||(w.input[t.code]={key:t,pressed:Date.now()})},document.onkeyup=function(t){t.preventDefault(),w.input[t.code]=null},requestAnimationFrame(z)}))}();